---
layout: post
title:  "Supabase"
date:   2025-12-09 15:25:31 +0100
categories: Supabase BaaS
---

- [About](#about)
- [Database](#database)
- [Authentication](#authentication)
  - [Magic link configuration](#magic-link-configuration)
  - [RLS and page restrictions](#rls-and-page-restrictions)


## About
Resources: [supabase docs](https://supabase.com/docs)

Is basically a collection of backends services.
* database (Postgres)
* Authentication
* Server side functions
* ...

## Database

A Postgres database

## Authentication
### Magic link configuration

Sign-in by sending an email to someone with a verification link, this link redirects you back to the application with a valid session.

Local development is a bit tricky, you need to enable a couple of features via config.toml that you would otherwise configure via the Web UI.

```toml
[auth]
enabled = true
# The base URL of your website. Used as an allow-list for redirects and for constructing URLs used
# in emails.
site_url = "http://localhost:5173"
# A list of *exact* URLs that auth providers are permitted to redirect to post authentication.
additional_redirect_urls = ["http://localhost:5173/**"]
...
[auth.email]
# Allow/disallow new user signups via email to your project.
enable_signup = true
# If enabled, a user will be required to confirm any email change on both the old, and new email
# addresses. If disabled, only the new email is required to confirm.
double_confirm_changes = true
# If enabled, users need to confirm their email address before signing in.
enable_confirmations = true
```
after this you need to restart supabase

this is one part, the other part is that emails are not sent to your actual email provider.

The emails get sent to the inbucket/mailpit container that is part of the supabase docker setup.

This is available on http://localhost:54324/

* [some article](https://makerkit.dev/docs/next-supabase-turbo/emails/inbucket)

* [supabase docs](https://supabase.com/docs/guides/local-development/cli/testing-and-linting#testing-auth-emails)

### RLS and page restrictions

In supabase on the table containing the records:
```sql
alter policy "only logged in users can insert"
on "public"."conversations"
to authenticated
with check (
  true
);
```

In your project:
ChatGPT/Gemini magic -> a component to wrap around a route basically try and get the supabase session and if no session found navigate to Login page

In an ideal world this component could be split up in 2.  One to manage the session and one for the route wrapping.

```tsx
supabase.auth.getSession().then(({ data: { session } }) => {
      setSession(session);
      setLoading(false);
    });

...
if (!session) {
    return <Navigate to="/login" replace />;
  }

  return <>{children}</>;
```

In the part containing the routing:
```tsx
<Route path="/newQuote" element={
    <ProtectedRoute>
        <NewQuote />
    </ProtectedRoute>}
/>
```

